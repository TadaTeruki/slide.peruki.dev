---
marp: true
theme: peru24doc2
title: PostGISã§éŠã¶ã‚¾ãƒ´
description: é•·ã„ğŸ˜ç”Ÿã€åŒ—æµ·é“ã®ğŸ˜ã„ç”£æ¥­æ–½è¨­ãŒæ°—ã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚‹
math: mathjax
author: Teruki TADA
session: ãƒãƒªã‚«ãƒ³æ˜¥LT
date: 2025-04-27
tags: GIS, mariconf
thumbnail: img/muroran.webp
paginate: true
---
![w:400](img/postgis.png)

&nbsp;**ã§ éŠ ã¶ ã‚¾ ãƒ´**

2025å¹´4æœˆ27æ—¥ æ˜¥LT

å¤šç”° ç‘›è²´ (@PerukiFUN)

![bg right:40%](img/all.webp)

---

## è‡ªå·±ç´¹ä»‹

å¤šç”° ç‘›è²´ (ãŸã  ã¦ã‚‹ã)

GitHub: TadaTeruki / X: @PerukiFUN / HP: peruki.dev

- ç¦å±± *åºƒå³¶çœŒ* â†’ äº¬éƒ½ â†’ å‡½é¤¨
- è¤‡é›‘ç³»çŸ¥èƒ½å­¦ç§‘ è¤‡é›‘ç³»ã‚³ãƒ¼ã‚¹ å­¦éƒ¨4å¹´ 
 *Mariners' Conferenceã‚‚ä»Šå¹´åº¦ã§4å¹´ç›®ã‚‰ã—ã„*
- Mariners' Conference è¨­ç«‹/å…ƒéƒ¨é•·
  - ä»Šã‚‚å­¦å†…/å­¦å¤–ã‚¤ãƒ™ãƒ³ãƒˆã®é‹å–¶ã‚’ã“ã¾ã”ã¾ã‚„ã£ã¦ã„ã¾ã™
  *ç‰©äº‹ã®ç«‹ã¡ä¸Šã’ã«ã‹ã‹ã‚‹æ ¹æ°—ã‚’èº«ã«ã¤ã‘ãŸæ°—ãŒã™ã‚‹*

![bg right:25% vertical](img/icon.webp)
![bg right:25%](img/honnin.webp)

---

## ğŸ˜ã¯ã˜ã‚ã«ğŸ˜

é•·ã„ğŸ˜ç”Ÿã€**åœ°å›³ã‹ã‚‰ä½•ã‚‰ã‹ã®æƒ…å ±ã‚’ã„ã„æ„Ÿã˜ã«å¼•ãå‡ºã—ãŸã„** æ™‚ãŒã‚ã‚‹ 

ä¾‹ãˆã°

 - å›½é“5å·ã®é•·ã•ã‚’æ¸¬ã‚‹
 - è¿‘ãã«ã‚ã‚‹é¢ç©ã®å¤§ãã„ç”£æ¥­æ–½è¨­ã‚’èª¿ã¹ã‚‹
 - å®¶ã‹ã‚‰æœ€ã‚‚è¿‘ã„é¢ç©ğŸ˜ğŸ˜ğŸ˜ä»¥ä¸Šã®ã‚¤ã‚ªãƒ³ãƒ¢ãƒ¼ãƒ«ã‚’æ¤œç´¢ã™ã‚‹
 - åŠå¾„ğŸ˜ğŸ˜kmä»¥å†…ã®æ¾å±‹ã¨è¥¿æ¾å±‹ã®åº—èˆ—ã‚’æ¢ã™


---

## ã‚ˆãã‚ã‚‹æ–¹æ³•: Google Maps

æ‰‹è»½ã«æƒ…å ±ã‚’å¾—ã‚‹åˆ†ã«ã¯ååˆ†ã ãŒ...
ãƒ‡ãƒ¼ã‚¿åˆ†æã¯ã§ããªã„
*APIã‚’ä½¿ã£ã¦ã‚‚ã€å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ã†ã®ã¯*
*æŠ€è¡“çš„ã«å›°é›£ã‹ã¤ãƒ©ã‚¤ã‚»ãƒ³ã‚¹é•å*

![bg left:35% w:400](img/nothern.webp)


---


ãã“ã§ã€ã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿ **OpenStreetMap (OSM)** ã‚’åˆ©ç”¨
*Open Database License(ODbL)ã«æº–æ‹ *
*åœ°å›³ãƒ‡ãƒ¼ã‚¿ã¯Geofabricã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹*

![bg right:25% w:200](img/osm.png)

*å‚è€ƒ: https://www.openstreetmap.org/*

---

## è§£æ±ºç­–A: Overpass API

OpenStreetMapãƒ™ãƒ¼ã‚¹
åœ°å›³ãƒ‡ãƒ¼ã‚¿ã®æ¤œç´¢ãŒã§ãã‚‹
*å‚è€ƒ: ã“ã¡ã‚‰ã§éŠã‚“ã ä¾‹ã¯ã€**Submarine vol.1ã«ã¦***
*ã€Overpass APIã§å…¨å›½ã®ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ãƒ‰åº—èˆ—ã®ä½ç½®æƒ…å ±ã‚’é›†ã‚ã‚ˆã†ã€*

**æ¬ ç‚¹**

- ç‹¬è‡ªã‚¯ã‚¨ãƒªè¨€èªOverpass QLã‚’æ‰±ã†å¿…è¦ãŒã‚ã‚‹
- ç’°å¢ƒæ§‹ç¯‰ãŒéå¸¸ã«é¢å€’

***Overpass Turbo**ãªã©ã®å…¬é–‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚‚å­˜åœ¨*
*æ‰‹è»½ã«ä½¿ã†ã«ã¯ã“ã‚Œã§ååˆ†*
*å‚è€ƒ: https://overpass-turbo.eu/*

![bg left:30% w:700](img/osmexp1.webp)

---

## è§£æ±ºç­–B: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

**DBMS: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ** 
å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã—æ‰±ã†ã‚·ã‚¹ãƒ†ãƒ 
*ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã‚„ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ãªã©æ™®éçš„ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹*

OSMã®ãƒ‡ãƒ¼ã‚¿ã‚’DBã¨ã—ã¦å–ã‚Šè¾¼ã‚“ã§èª­ã¿è¾¼ã‚“ã§
æ¤œç´¢ã‚„è¨ˆç®—ã‚’è¡Œã†

![bg left:30% w:400](img/columns.webp)

**æ¬ ç‚¹**

- ã‚¯ã‚¨ãƒªè¨€èªSQLã‚’è¦šãˆã‚‹å¿…è¦ãŒã‚ã‚‹
*ãŸã ã—å¯æ¬æ€§ã®é«˜ã„çŸ¥è­˜ã§ã€ã‚€ã—ã‚ã‚ã‚ŠãŒãŸã„ç‚¹ã§ã‚‚ã‚ã‚‹*

---

## ã¨ã„ã†ã“ã¨ã§ä»Šå›ã¯PostGISã‚’å°å…¥ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜

![bg right:35% w:400](img/postgis.png)


åœ°ç†ç©ºé–“ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ãŸã‚ã®
PostgreSQL (DBMS) ã®æ‹¡å¼µæ©Ÿèƒ½

ãƒ‡ãƒ¼ã‚¿ã®æ¤œç´¢ã ã‘ã§ãªãã€é•·ã•ã‚„é¢ç©ã®è¨ˆç®—
é‡ãªã‚Šã®åˆ¤å®šã¨ã„ã£ãŸæ§˜ã€…ãªã‚¿ã‚¹ã‚¯ã‚’æ‰±ãˆã‚‹

*å‚è€ƒ: https://postgis.net/docs/manual-1.5/ch08.html*


---

## ã‚„ã‚‹ã“ã¨

é•·ã„ğŸ˜ç”Ÿã€**åŒ—æµ·é“ã§ä¸€ç•ªğŸ˜ã„
ç”£æ¥­æ–½è¨­ãŒæ°—ã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚‹**

- è£½é‰„æ‰€ãŒåœ§å€’çš„ï¼Ÿ
- è£½ç´™ç”£æ¥­é–¢é€£æ–½è¨­
- å¤ªé™½å…‰ç™ºé›»æ–½è¨­

ç”£æ¥­æ–½è¨­ã‚’é¢ç©é †ã«ä¸¦ã¹
æœ€ã‚‚å¤§ãã„æ–½è¨­ã‚’èª¿ã¹ã‚ˆã†

![bg right:50% w:900](img/muroran.webp)

---

## åŸºæœ¬çš„ãªæµã‚Œ


1. å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—: **Overpass API**
2. DBã‚’ç«‹ã¦ã‚‹: Docker
3. OSMãƒ‡ãƒ¼ã‚¿ã‚’DBã¸å–ã‚Šè¾¼ã‚€: GDAL/OGR
4. ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢: **PostGIS**
5. å¯è¦–åŒ–: QGIS

*(1)ã«ã¤ã„ã¦ã¯*
*OSMã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã¯åµ©å¼µã‚Šã™ããŸã®ã§*
*å…¬é–‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**Overpass Turbo**ã‚’ä½¿ç”¨*

![bg right:40% vertical](img/2.webp)
![bg](img/all.webp)


---

## çµæœ

---

<!-- _color: gray -->

**çµæœ: åŒ—æµ·é“å…¨åœŸ**

![bg](img/all.webp)

---
<!-- _color: gray -->

**çµæœ: å®¤è˜­å¸‚**


![bg](img/muroran.webp)

---

<!-- _color: gray -->

**çµæœ: ä¸Šå·åœ°æ–¹å‘¨è¾º**

![bg](img/shibetsu_wide.webp)


---

## ä½•ã¨ãªã

**èƒ†æŒ¯åœ°æ–¹ãŒå¼·ãã†**

- å®¤è˜­ã‚‚è‹«å°ç‰§ã‚‚ã‚ã‚‹...
- è£½é‰„ã‚‚è£½ç´™ã‚‚ã‚ã‚‹...
- ã‚¦ãƒãƒã‚¤ã‚‚ã‚¯ãƒç‰§å ´ã‚‚ã‚ã‚‹...

![w:900](img/tomakomai.webp)

---

## ç”£æ¥­æ–½è¨­ã”ã¨ã®é¢ç©ãƒ©ãƒ³ã‚­ãƒ³ã‚° (å¤§ãã„é †)

```sql
SELECT ind.name, ct.name, sb.name, ROUND(CAST(ind.area AS NUMERIC),2)
FROM industries AS ind
JOIN cities AS ct ON ind.city_id=ct.id
JOIN subprefectures AS sb ON ct.subprefecture_id=sb.id
ORDER BY ind.area DESC
LIMIT 30;
```

---

![bg right:70%](img/2.webp)

**è‡ªå‹•è»Šè©¦é¨“å ´ï¼ï¼Ÿ**


---

## å¸‚ç”ºæ‘ã”ã¨ã®ç”£æ¥­æ–½è¨­ã®é¢ç©ã®åˆè¨ˆ (å¤§ãã„é †)

```sql
WITH rank_ind AS (
  SELECT ind.id, ind.name, ROW_NUMBER() OVER (PARTITION BY ct.id ORDER BY ind.area DESC) AS rn
  FROM industries AS ind, cities AS ct
  WHERE ind.city_id=ct.id
)
SELECT ct.name, sb.name, ROUND(CAST(SUM(ind.area) AS NUMERIC),2) AS indsum, rank_ind.name
FROM cities AS ct
JOIN industries AS ind ON ind.city_id=ct.id
JOIN subprefectures AS sb ON ct.subprefecture_id=sb.id
JOIN rank_ind ON rank_ind.id=ind.id
WHERE rank_ind.rn=1
GROUP BY ct.id, sb.name, rank_ind.name
ORDER BY indsum DESC
LIMIT 20;
```

---

![bg right:70% h:500](img/4.webp)

**å£«åˆ¥å¸‚ï¼ï¼Ÿ**

---

**è‡ªå‹•è»Šè©¦é¨“å ´ãŒæœ€å¼·ã‚‰ã—ã„...**

ä¸Šä½ã®ç”£æ¥­æ–½è¨­ã¯
è‡ªå‹•è»Šé–¢é€£ã®è©¦é¨“å ´ãŒ
å¤šãã‚’å ã‚ã¦ã„ã‚‹

![bg left:50% w:600](img/shibetsu.webp)

---

<!-- _class: smartblockquote -->

## å£«åˆ¥å¸‚ã®è‡ªå‹•è»Šè©¦é¨“å ´

å£«åˆ¥å¸‚ã¯ã€Œè‡ªå‹•è»Šç­‰è©¦é¨“ç ”ç©¶ã®ã¾ã¡ãƒ»å£«åˆ¥å¸‚ã€ã¨ã—ã¦è¡—ã‚’PRã—ã¦ã„ã‚‹ã‚‰ã—ã„
> ã“ã‚Œã‚‰5ã‹æ‰€ã®è©¦é¨“å ´ã®ç·é¢ç©ã¯ã€è¡Œæ”¿åŒºåŸŸé¢ç©ã®ç´„2.8ï¼…ã‚’å ã‚ã‚‹1,670haã«åŠã³ã€å…¨å›½ã«é¡ã®ãªã„è¦æ¨¡ã®è©¦é¨“å ´ã®é›†ç©åœ°ã¨ãªã‚Šã¾ã—ãŸã€‚...(ä¸­ç•¥)...å£«åˆ¥å¸‚ã¯ã‹ã¤ã¦ã®å†¬æœŸé–“ã®è€å¯’è©¦é¨“ã ã‘ã®ã¾ã¡ã‹ã‚‰ã€è‡ªå‹•è»Šç­‰è©¦é¨“ç ”ç©¶ã®ã¾ã¡ã¸ã¨å¤‰è²Œã‚’é‚ã’ã¾ã—ãŸã€‚

---

![bg](img/shibetsupr.webp)

---

## é“å—ã¯é“å—ã§ã™ã‹ (æ€’)

```sql
SELECT ind.name, ct.name, sb.name, ROUND(CAST(ind.area AS NUMERIC),2)
FROM industries AS ind
JOIN cities AS ct on ind.city_id=ct.id
JOIN subprefectures AS sb on ct.subprefecture_id=sb.id 
WHERE ST_Y(ST_Centroid(ind.geom)) < 42.25
AND sb.name IN ('æ¸¡å³¶ç·åˆæŒ¯èˆˆå±€', 'æªœå±±æŒ¯èˆˆå±€')
ORDER BY ind.area
DESC LIMIT 10;
```

---

### çµæœ

![w:800](img/5.webp)

æ–½è¨­åãŒç©ºã«ãªã£ã¦ã„ã‚‹...
å¯è¦–åŒ–ã—ã¦è¦‹æ¯”ã¹ã¦ã¿ã‚‹ã¨

---

![bg left:50%](img/hokuto2.webp)

**å³©æœ—é‰±å±±ã ã£ãŸï¼**

çŸ³ç°çŸ³ã®é‰±å±±

åŒ—æ–—å¸‚ã®ã‚»ãƒ¡ãƒ³ãƒˆå·¥å ´ã¯ç¾å½¹æœ€å¤
æ˜”ã¯å°‚ç”¨ã®é›»æ°—é‰„é“ã‚‚
é€šã£ã¦ã„ãŸã‚‰ã—ã„

---

## æ³¨æ„: OSMãƒ‡ãƒ¼ã‚¿ã®èª²é¡Œã«ã¤ã„ã¦

OSMã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã†å ´åˆ
æƒ…å ±é‡ã®å°‘ãªã•ã‚„åœ°åŸŸå·®ãŒå­˜åœ¨ã™ã‚‹å ´åˆãŒã‚ã‚‹
*ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ç‰¹æœ‰ã®èª²é¡Œ*

ä»Šå›ã®çµæœã¯æ­£ç¢ºã§ãªã„å¯èƒ½æ€§ã‚‚ã‚ã‚‹ã®ã§æ³¨æ„
*æœ¬å½“ã®ãƒ‡ãƒ¼ã‚¿åˆ†æç”¨é€”ã§ã‚ã‚Œã°ã€ç”¨é€”ã«å¿œã˜ã¦
ä¿¡é ¼ã§ãã‚‹æä¾›å…ƒã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã‚‰ã†å¿…è¦ãŒã‚ã‚‹*

*è©±é¡Œ: ä¿¡é ¼æ€§ã®ã‚ã‚‹ã‚ªãƒ¼ãƒ—ãƒ³ãªåœ°å›³ãƒ‡ãƒ¼ã‚¿ã®æä¾›ã‚’ç›®æ¨™ã¨ã™ã‚‹
ä¼æ¥­å›£ä½“ã«ã‚ˆã‚‹**Overture Maps**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚‚å­˜åœ¨*

---

## ãŠã‚ã‚Šã«

- é•·ã„ğŸ˜ç”Ÿã€åœ°å›³ã‹ã‚‰ä½•ã‚‰ã‹ã®æƒ…å ±ã‚’
ã„ã„æ„Ÿã˜ã«å¼•ãå‡ºã™æ–¹æ³•ã‚’ç´¹ä»‹
- ä»Šå›ã¯PostGISã‚’ä½¿ç”¨
ç”¨é€”ã«ã‚ˆã£ã¦ã¯MySQLã‚„SQLite
DuckDBã‚‚è¦–é‡ã«å…¥ã‚‹ã®ã§
è‰²ã€…è©¦ã—ã¦ã¿ã¦ã¿ã¦ãã ã•ã„

*åŸä½œ: https://peruki.dev/blogs/articles/postgis*

![bg right:40%](img/all.webp)
